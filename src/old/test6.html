<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html" lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="../css/style.css" type="text/css" rel="stylesheet" media="all">
    <link rel="icon" href="../css/icon.ico" sizes=any >
    <title>Produkt-Check</title>
</head>
<body onload="drawGraph();openCity(event, 'Product1');init()">

<h2>Produkte Bewertung</h2>

<p>Die Produkt-Check Web-App unterstützt Sie dabei, ein Produkt anhand der wichtigsten Kriterien zu bewerten.<br><br>
    Die Kriterienliste umfasst verschiedene Faktoren wie „Kundennutzen“, „Technische Qualität“, „Marktpreis“ usw.
    Für jedes Kriterium bewerten Sie Ihr Produkt auf einer Skala von -3 bis +3:<br><br>
    &#8226;  -&nbsp3 &nbsp=&nbsp unterdurchschnittlich<br>
    &#8226;  &nbsp 0 &nbsp=&nbsp durchschnittlich<br>
    &#8226;  +3 &nbsp=&nbsp überdurchschnittlich<br><br>
    Sie können bis zu drei Produkte gleichzeitig bewerten. Für jedes Produkt wird ein eigener Graph erstellt,
    der in einer anderen Farbe angezeigt wird.<br><br>
    Für einen neuen Check klicken Sie auf „Produkte zurücksetzen“<br><br>


<div class="tab">
    <button class="tablinks" onclick="openCity(event, 'Product1')">Produkt 1</button>
    <button class="tablinks" onclick="openCity(event, 'Product2')">Produkt 2</button>
    <button class="tablinks" onclick="openCity(event, 'Product3')">Produkt 3</button>
</div>


<div id="Product1" class="tabcontent"></div>
<div id="Product2" class="tabcontent"></div>
<div id="Product3" class="tabcontent"></div>


<button class="delete-btn" onclick="resetProduct('${productId}'); drawGraph()">Produkte zurücksetzen</button>


<div class="prod1">
    <label><input type="checkbox" class="prd1" id="toggleProduct1" checked onchange="drawGraph()"> Produkt 1 anzeigen&nbsp&nbsp</label><br>
</div>

<div class="prod2">
    <label><input type="checkbox" class="prd2" id="toggleProduct2" checked onchange="drawGraph()"> Produkt 2 anzeigen&nbsp&nbsp</label><br>
</div>

<div class="prod3">
    <label><input type="checkbox" class="prd3" id="toggleProduct3" checked onchange="drawGraph()"> Produkt 3 anzeigen&nbsp&nbsp</label><br>
</div>


<div class="graph">
    <canvas id="productGraph"></canvas>
</div>


<button onclick="exportToCSV()" style="display: flex; margin: 20px auto; padding: 10px 20px; font-size: 16px; background-color: #007BFF; color: white; border: none; border-radius: 4px; cursor: pointer;">Exportiere Daten als CSV</button>



<script>
    function init() {
        const product1Button = document.querySelector("button.tablinks:nth-child(1)");
        openCity(event, 'Product1');
        product1Button.className += " active";
    }

    let productCount = 3;
    const criteria = [
        "Kundennutzen", "Kundenakzeptanz", "Innovativität", "Technische Qualität", "Zubehör & Optionen", "Dokumentation", "Serviceleistungen",


        "Marktpreis", "Händlerrabatte", "Preis/Leistung",

        "Flächendeckung", "Qualität Vertrieb", "Motivation Vertrieb", "Abnehmerbindung", "Lieferzeit", "Liefertreue",

        "Bekanntheitsgrad", "Produktimage", "Werbemaßnahmen", "Verkaufsförderung", "Pressearbeit",

        "Erzielte Umsätze", "Erzielte Gewinne (DB)", "Beschaffungssituation", "F&E Kompetenz", "Produktteam"

    ];

    function createTabContent(productId) {
        const tabContent = document.getElementById(productId);
        tabContent.innerHTML = `
            <table>
                <thead>
                    <tr>
                        <th>Kriterium</th>
                        <th>-3</th>
                        <th>-2</th>
                        <th>-1</th>
                        <th>0</th>
                        <th>+1</th>
                        <th>+2</th>
                        <th>+3</th>
                    </tr>
                </thead>
                <tbody id="criteriaTableBody-${productId}">
                </tbody>
            </table>

        `;

        const tableBody = document.getElementById(`criteriaTableBody-${productId}`);
        criteria.forEach((criterion, index) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td class="criterion-name">${criterion}</td>
                <td><input type="radio" name="rating-${productId}-${index}" onchange="drawGraph()" value="-3"></td>
                <td><input type="radio" name="rating-${productId}-${index}" onchange="drawGraph()" value="-2"></td>
                <td><input type="radio" name="rating-${productId}-${index}" onchange="drawGraph()" value="-1"></td>
                <td><input type="radio" name="rating-${productId}-${index}" onchange="drawGraph()" value="0"></td>
                <td><input type="radio" name="rating-${productId}-${index}" onchange="drawGraph()" value="1"></td>
                <td><input type="radio" name="rating-${productId}-${index}" onchange="drawGraph()" value="2"></td>
                <td><input type="radio" name="rating-${productId}-${index}" onchange="drawGraph()" value="3"></td>
            `;
            tableBody.appendChild(row);
        });
    }


    function openCity(evt, cityName) {
        const tabcontent = document.getElementsByClassName("tabcontent");
        for (let i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        const tablinks = document.getElementsByClassName("tablinks");
        for (let i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(cityName).style.display = "block";
        evt.currentTarget.className += " active";
    }


    createTabContent("Product1");
    createTabContent("Product2");
    createTabContent("Product3");


    function resetProduct() {
            // Alle Radio-Buttons zurücksetzen
            document.querySelectorAll('input[type="radio"]').forEach(input => input.checked = false);

            // Canvas bereinigen
            const canvas = document.getElementById('productGraph');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Graph neu zeichnen
            drawGraph();
    }



    function exportToCSV() {
        const rows = [["Produkt", "Kriterium", "Bewertung"]];
        for (let i = 1; i <= productCount; i++) {
            const productId = `Product${i}`;
            const tableBody = document.getElementById(`criteriaTableBody-${productId}`);
            if (!tableBody) continue;

            const rowsInTable = tableBody.getElementsByTagName("tr");
            for (let row of rowsInTable) {
                const criterion = row.querySelector(".criterion-name").innerText;
                const inputs = row.querySelectorAll("input[type='radio']");
                let rating = "";
                inputs.forEach(input => {
                    if (input.checked) rating = input.value;
                });
                rows.push([`Produkt ${i}`, criterion, rating || "Keine Bewertung"]);
            }
        }
        const csvContent = rows.map(e => e.join(",")).join("\n");
        const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
        const link = document.createElement("a");
        const url = URL.createObjectURL(blob);
        link.setAttribute("href", url);
        link.setAttribute("download", "product_data.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }


    const productColors = ["#0000ff", "#FF0000", "#00CA00"]; // Farben für die Produkte

    function drawGraph() {
        const criteria = [
            "Kundennutzen", "Kundenakzeptanz", "Innovativität", "Technische Qualität",
            "Zubehör & Optionen", "Dokumentation", "Serviceleistungen", "Marktpreis",
            "Händlerrabatte", "Preis/Leistung", "Flächendeckung", "Qualität Vertrieb",
            "Motivation Vertrieb", "Abnehmerbindung", "Lieferzeit", "Liefertreue",
            "Bekanntheitsgrad", "Produktimage", "Werbemaßnahmen", "Verkaufsförderung",
            "Pressearbeit", "Erzielte Umsätze", "Erzielte Gewinne (DB)",
            "Beschaffungssituation", "F&E Kompetenz", "Produktteam"
        ];

        const canvas = document.getElementById('productGraph');
        const ctx = canvas.getContext('2d');
        canvas.width = 2200; // Breite des Canvas
        canvas.height = 1300; // Höhe des Canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "black";
        ctx.strokeStyle = "black";
        ctx.lineWidth = 3;
        ctx.lineJoin = 'round';
        ctx.lineCap = 'round';

        const width = canvas.width;
        const height = canvas.height;
        const padding = 100;
        const xStep = (width - padding * 2) / (criteria.length - 1);
        const yStep = (height / 1.5 - padding * 2) / 6;

        // Y-Achse zeichnen
        ctx.beginPath();
        ctx.moveTo(padding, padding);
        ctx.lineTo(padding, height / 1.5 - padding);
        ctx.stroke();

        // X-Achse zeichnen
        ctx.beginPath();
        ctx.moveTo(padding, height / 3);
        ctx.lineTo(width - padding, height / 3);
        ctx.stroke();

        // Y-Skala und -Labels von -3 bis +3
        ctx.font = "50px Arial";
        ctx.textAlign = "right";
        for (let i = -3; i <= 3; i++) {
            const y = height / 3 - i * yStep;
            ctx.beginPath();
            ctx.moveTo(padding - 10, y);
            ctx.lineTo(padding + 2200, y);
            ctx.stroke();
            ctx.fillText(i, padding - 15, y + 5);
        }

        // Vertikale Linien für jedes Kriterium hinzufügen
        ctx.setLineDash([5, 5]); // Gepunktete Linien

        criteria.forEach((_, index) => {
            const x = 200 + index * xStep;

            ctx.beginPath();
            ctx.moveTo(x, padding);         // Startpunkt für die Linie (an der X-Achse)
            ctx.lineTo(x, height - 432 - padding);    // Endpunkt für die Linie (unten am Canvas)
            ctx.stroke();
        });

        // Labels für die Kriterien (gedrehter Text)
        ctx.save();
        ctx.textAlign = "right";
        ctx.font = "50px Arial";
        for (const criterion of criteria) {
            const index = criteria.indexOf(criterion);
            const x = 200 + index * xStep;
            const y = height - padding - 390;

            ctx.translate(x, y);
            ctx.rotate(-Math.PI / 3);
            ctx.fillText(criterion, 0, 0);
            ctx.rotate(Math.PI / 3);
            ctx.translate(-x, -y);
        }
        ctx.restore();
        ctx.setLineDash([5, 0]);


        // Graphen zeichnen, falls die Checkbox aktiviert ist
        for (let i = 1; i <= productCount; i++) {
            const checkbox = document.getElementById(`toggleProduct${i}`);
            if (checkbox && checkbox.checked) {
                drawGraphForProduct(`Product${i}`, productColors[i - 1]);
            }
        }
    }



        // Graphen für jedes Produkt zeichnen
        for (let i = 1; i <= productCount; i++) {
            const productId = `Product${i}`;
            const color = productColors[i - 1];
            drawGraphForProduct(productId, color);
        }


    function drawGraphForProduct(productId, color) {
        const canvas = document.getElementById('productGraph');
        const ctx = canvas.getContext('2d');

        const padding = 100;
        const xStep = (canvas.width - padding * 2) / (criteria.length - 1);
        const yStep = (canvas.height / 1.5 - padding * 2) / 6;

        ctx.beginPath();
        ctx.strokeStyle = color;
        ctx.lineWidth = 8;

        const tableBody = document.getElementById(`criteriaTableBody-${productId}`);
        if (!tableBody) return;

        criteria.forEach((criterion, index) => {
            const row = tableBody.children[index];
            const inputs = row.querySelectorAll("input[type='radio']");
            let rating = 0;
            inputs.forEach(input => {
                if (input.checked) rating = parseInt(input.value);
            });

            const x = 200 + index * xStep;
            const y = canvas.height / 3 - rating * yStep;

            if (index === 0) {
                ctx.moveTo(x, y);
            } else {
                ctx.lineTo(x, y);
            }
        });

        ctx.stroke();
    }

</script>

</body>
</html>
